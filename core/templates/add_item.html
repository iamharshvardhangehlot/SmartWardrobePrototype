{% extends 'base.html' %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-[80vh] p-6">
    <div class="w-full max-w-md bg-gray-800 rounded-3xl shadow-2xl overflow-hidden border border-gray-700">
        <div class="bg-gray-900 p-4 flex justify-between items-center border-b border-gray-700">
            <h2 class="text-xl font-bold text-white">Add New Items</h2>
            <div class="flex bg-gray-800 rounded-lg p-1">
                <button onclick="switchMode('single')" id="btn-single"
                    class="px-4 py-1 rounded-md text-sm font-bold transition {% if active_mode == 'single' %}bg-blue-600 text-white{% else %}text-gray-400{% endif %}">
                    Single
                </button>
                <button onclick="switchMode('bulk')" id="btn-bulk"
                    class="px-4 py-1 rounded-md text-sm font-bold transition {% if active_mode == 'bulk' %}bg-purple-600 text-white{% else %}text-gray-400{% endif %}">
                    Bulk
                </button>
            </div>
        </div>

        <div class="p-8">
            <form id="form-single" method="post" enctype="multipart/form-data" class="space-y-6 {% if active_mode == 'bulk' %}hidden{% endif %}">
                {% csrf_token %}

                <div class="space-y-2">
                    <label class="text-blue-300 font-bold text-sm uppercase tracking-wide">1. Upload Cloth Photo</label>
                    <div class="relative group">
                        {{ form.image }}
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-blue-300 font-bold text-sm uppercase tracking-wide">2. Price (INR)</label>
                    {{ form.purchase_price }}
                </div>

                <div class="space-y-2">
                    <label class="text-blue-300 font-bold text-sm uppercase tracking-wide">3. Fabric Type</label>
                    {{ form.fabric_type }}
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-[1.02] flex items-center justify-center gap-2">
                    Analyze with AI
                </button>
            </form>

            <form id="form-bulk" method="post" enctype="multipart/form-data" class="space-y-6 {% if active_mode == 'single' %}hidden{% endif %}">
                {% csrf_token %}
                <input type="hidden" name="bulk_upload" value="true">

                <div class="space-y-2">
                    <label class="text-purple-300 font-bold text-sm uppercase tracking-wide">1. Select Multiple Photos</label>
                    <label for="bulk-images-input" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-600 rounded-xl hover:border-purple-500 hover:bg-gray-700/50 transition cursor-pointer">
                        <span class="text-gray-400 font-bold text-sm" id="file-count">Click to select files</span>
                        <span class="text-gray-500 text-xs mt-1">JPG, PNG supported</span>
                        <input type="file"
                               name="images"
                               id="bulk-images-input"
                               class="hidden"
                               multiple
                               accept="image/*">
                    </label>
                </div>

                <div class="space-y-2">
                    <label class="text-purple-300 font-bold text-sm uppercase tracking-wide">2. Price for All Items</label>
                    {{ bulk_form.bulk_price }}
                </div>

                <div class="space-y-2">
                    <label class="text-purple-300 font-bold text-sm uppercase tracking-wide">3. Default Fabric Type</label>
                    {{ bulk_form.fabric_type }}
                </div>

                <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-[1.02] flex items-center justify-center gap-2">
                    Run Batch Analysis
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    function switchMode(mode) {
        const singleForm = document.getElementById('form-single');
        const bulkForm = document.getElementById('form-bulk');
        const btnSingle = document.getElementById('btn-single');
        const btnBulk = document.getElementById('btn-bulk');

        if (mode === 'single') {
            singleForm.classList.remove('hidden');
            bulkForm.classList.add('hidden');

            btnSingle.className = "px-4 py-1 rounded-md text-sm font-bold bg-blue-600 text-white transition";
            btnBulk.className = "px-4 py-1 rounded-md text-sm font-bold text-gray-400 hover:text-white transition";
        } else {
            singleForm.classList.add('hidden');
            bulkForm.classList.remove('hidden');

            btnSingle.className = "px-4 py-1 rounded-md text-sm font-bold text-gray-400 hover:text-white transition";
            btnBulk.className = "px-4 py-1 rounded-md text-sm font-bold bg-purple-600 text-white transition";
        }
    }

    const bulkInput = document.getElementById('bulk-images-input');
    if (bulkInput) {
        bulkInput.addEventListener('change', function(e) {
            const count = e.target.files.length;
            document.getElementById('file-count').innerText = count > 0
                ? `Selected ${count} files`
                : "Click to select files";
        });
    }
</script>
{% endblock %}
